// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
* Copyright 2019 NXP
*/

/dts-v1/;

#include "imx8mn.dtsi"

/ {
	model = "Westermo Envoy Platform";
	compatible = "westermo,envoy", "fsl,imx8mn";

	chosen {
		stdout-path = &uart1;
	};

	reg_usdhc2_vmmc: regulator-usdhc2 {
		compatible = "regulator-fixed";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_reg_usdhc2_vmmc>;
		regulator-name = "VSD_3V3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		gpio = <&gpio2 19 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};
};

&cpu_alert0 {
	temperature = <95000>;
};

&cpu_crit0 {
	temperature = <105000>;
};

&iomuxc {
	pinctrl-names = "default";

	pinctrl_fec1: fec1grp {
		fsl,pins = <
		MX8MN_IOMUXC_ENET_MDC_ENET1_MDC		0x3
		MX8MN_IOMUXC_ENET_MDIO_ENET1_MDIO	0x3
		MX8MN_IOMUXC_ENET_TD3_ENET1_RGMII_TD3	0x1f
		MX8MN_IOMUXC_ENET_TD2_ENET1_RGMII_TD2	0x1f
		MX8MN_IOMUXC_ENET_TD1_ENET1_RGMII_TD1	0x1f
		MX8MN_IOMUXC_ENET_TD0_ENET1_RGMII_TD0	0x1f
		MX8MN_IOMUXC_ENET_RD3_ENET1_RGMII_RD3	0x91
		MX8MN_IOMUXC_ENET_RD2_ENET1_RGMII_RD2	0x91
		MX8MN_IOMUXC_ENET_RD1_ENET1_RGMII_RD1	0x91
		MX8MN_IOMUXC_ENET_RD0_ENET1_RGMII_RD0	0x91
		MX8MN_IOMUXC_ENET_TXC_ENET1_RGMII_TXC	0x1f
		MX8MN_IOMUXC_ENET_RXC_ENET1_RGMII_RXC	0x91
		MX8MN_IOMUXC_ENET_RX_CTL_ENET1_RGMII_RX_CTL	0x91
		MX8MN_IOMUXC_ENET_TX_CTL_ENET1_RGMII_TX_CTL	0x1f
		MX8MN_IOMUXC_SAI2_RXC_GPIO4_IO22	0x19
		>;
	};

	pinctrl_flexspi0: flexspi0grp {
		fsl,pins = <
		MX8MN_IOMUXC_NAND_ALE_QSPI_A_SCLK 0x1c4
		MX8MN_IOMUXC_NAND_CE0_B_QSPI_A_SS0_B 0x84

		MX8MN_IOMUXC_NAND_DQS_QSPI_A_DQS 0x40000084
		MX8MN_IOMUXC_NAND_DATA00_QSPI_A_DATA0 0x84
		MX8MN_IOMUXC_NAND_DATA01_QSPI_A_DATA1 0x84
		MX8MN_IOMUXC_NAND_DATA02_QSPI_A_DATA2 0x84
		MX8MN_IOMUXC_NAND_DATA03_QSPI_A_DATA3 0x84
		>;
	};

	pinctrl_leds: ledgrp {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO10_GPIO1_IO10	0
		MX8MN_IOMUXC_GPIO1_IO11_GPIO1_IO11	0
		MX8MN_IOMUXC_GPIO1_IO12_GPIO1_IO12	0
		MX8MN_IOMUXC_GPIO1_IO13_GPIO1_IO13	0
		MX8MN_IOMUXC_GPIO1_IO14_GPIO1_IO14	0
		>;
	};

	pinctrl_reg_usdhc2_vmmc: regusdhc2vmmc {
		fsl,pins = <
		MX8MN_IOMUXC_SD2_RESET_B_GPIO2_IO19	0x41
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
		MX8MN_IOMUXC_UART1_RXD_UART1_DCE_RX	0x140
		MX8MN_IOMUXC_UART1_TXD_UART1_DCE_TX	0x140
		>;
	};

	pinctrl_usdhc2_gpio: usdhc2grpgpio {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO15_GPIO1_IO15	0x1c4
		>;
	};

	pinctrl_usdhc1: usdhc1grp {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO06_USDHC1_CD_B     0
                MX8MN_IOMUXC_SD1_CLK_USDHC1_CLK         0x190
                MX8MN_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d0
                MX8MN_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d0
                MX8MN_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d0
                MX8MN_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d0
                MX8MN_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d0
		>;
	};

	pinctrl_usdhc1_100mhz: usdhc1-100mhzgrp {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO06_USDHC1_CD_B     0
                MX8MN_IOMUXC_SD1_CLK_USDHC1_CLK         0x194
                MX8MN_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d4
                MX8MN_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d4
                MX8MN_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d4
                MX8MN_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d4
                MX8MN_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d4
		>;
	};

	pinctrl_usdhc1_200mhz: usdhc1-200mhzgrp {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO06_USDHC1_CD_B     0
                MX8MN_IOMUXC_SD1_CLK_USDHC1_CLK         0x196
                MX8MN_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d6
                MX8MN_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d6
                MX8MN_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d6
                MX8MN_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d6
                MX8MN_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d6
		>;
	};

	pinctrl_wdog: wdoggrp {
		fsl,pins = <
		MX8MN_IOMUXC_GPIO1_IO02_WDOG1_WDOG_B		0xc6
		>;
	};
};

&fec1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_fec1>;
	phy-mode = "rgmii-id";
	phy-handle = <&switch>;
	fsl,magic-packet;
	status = "okay";

	mdio {
		#address-cells = <1>;
		#size-cells = <0>;

		switch: ethernet-phy@4 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = <4>;
		};
	};
};

&flexspi {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_flexspi0>;
	status = "okay";

	flash0: mt25ql01g@0 {
		reg = <0>;
		compatible = "jedec,spi-nor";
		spi-max-frequency = <80000000>;
		spi-tx-bus-width = <4>;
		spi-rx-bus-width = <4>;
	};
};

/ {
	gpio-leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_leds>;

		status-red {
			label = "red:status";
			gpios = <&gpio1 10 GPIO_ACTIVE_LOW>;
		};
		status-green {
			label = "green:status";
			gpios = <&gpio1 11 GPIO_ACTIVE_LOW>;
		};

		ring-red {
			label = "red:ring";
			gpios = <&gpio1 12 GPIO_ACTIVE_LOW>;
		};
		ring-green {
			label = "green:ring";
			gpios = <&gpio1 13 GPIO_ACTIVE_LOW>;
		};

		taint-red {
			label = "red:taint";
			gpios = <&gpio1 14 GPIO_ACTIVE_HIGH>;
			default-state = "keep";
		};
	};
};

&snvs_pwrkey {
	status = "okay";
};

&uart1 { /* console */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};

&usdhc1 {
	#address-cells = <1>;
	#size-cells = <0>;
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc1>;
	pinctrl-1 = <&pinctrl_usdhc1_100mhz>;
	pinctrl-2 = <&pinctrl_usdhc1_200mhz>;
	bus-width = <4>;
	status = "okay";
};

&wdog1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_wdog>;
	fsl,ext-reset-output;
	status = "okay";
};
